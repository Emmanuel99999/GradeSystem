@model AcademicGradingSystem.Models.Report
@using System.Collections.Generic

@{
    ViewData["Title"] = "Report Details";

    var breakdown = ViewData["Breakdown"] as IEnumerable<dynamic>;
}

<h2>Report Details</h2>

<div class="card mb-4">
    <div class="card-body">
        <h4>Student</h4>
        <p>
            @Model.Student?.FirstName @Model.Student?.LastName (@Model.Student?.Email)
        </p>

        <h4>Course</h4>
        <p>
            @Model.Course?.CourseName - @Model.Course?.Subject?.SubjectName
        </p>

        <h4>Final Grade</h4>
        <p>
            <strong>@Model.FinalGrade</strong>
        </p>

        <p>
            Generated at: @Model.GeneratedAt.ToLocalTime()
        </p>
    </div>
</div>

@if (breakdown != null)
{
    <h3>Grade Breakdown</h3>

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Activity</th>
                <th>Weight</th>
                <th>Score</th>
                <th>Weighted Contribution</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in breakdown)
            {
     
                double? score = null;
                double weight = 0;

          
                if (item.Score != null)
                {
                    score = (double)item.Score; 
                }

                weight = (double)item.Weight;

                double? contribution = null;
                if (score != null)
                {
         
                    contribution = score.Value * (weight / 100.0);
                }

                <tr>
                    <td>@item.ActivityName</td>
                    <td>@weight %</td>
                    <td>@(score?.ToString("0.00") ?? "-")</td>
                    <td>@(contribution.HasValue ? contribution.Value.ToString("0.00") : "-")</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No breakdown data available.</p>
}
